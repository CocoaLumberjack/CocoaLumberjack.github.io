<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CustomFormatters  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="CustomFormatters  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">CocoaLumberjack 3.6.1 Docs</a> (64% documented)</p>
        <p class="header-right"><a href="https://github.com/CocoaLumberjack/CocoaLumberjack"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">CocoaLumberjack Reference</a>
        <img id="carat" src="img/carat.png" />
        CustomFormatters  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="arc.html">ARC</a>
              </li>
              <li class="nav-group-task">
                <a href="appcode-support.html">AppCode-support</a>
              </li>
              <li class="nav-group-task">
                <a href="architecture.html">Architecture</a>
              </li>
              <li class="nav-group-task">
                <a href="combineloggers.html">CombineLoggers</a>
              </li>
              <li class="nav-group-task">
                <a href="customcontext.html">CustomContext</a>
              </li>
              <li class="nav-group-task">
                <a href="customformatters.html">CustomFormatters</a>
              </li>
              <li class="nav-group-task">
                <a href="customloglevels.html">CustomLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="customloggers.html">CustomLoggers</a>
              </li>
              <li class="nav-group-task">
                <a href="dynamicloglevels.html">DynamicLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="faq.html">FAQ</a>
              </li>
              <li class="nav-group-task">
                <a href="finegrainedlogging.html">FineGrainedLogging</a>
              </li>
              <li class="nav-group-task">
                <a href="gettingstarted.html">GettingStarted</a>
              </li>
              <li class="nav-group-task">
                <a href="logfilemanagement.html">LogFileManagement</a>
              </li>
              <li class="nav-group-task">
                <a href="perloggerloglevels.html">PerLoggerLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="peruserloglevels.html">PerUserLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="performance.html">Performance</a>
              </li>
              <li class="nav-group-task">
                <a href="problemsolution.html">ProblemSolution</a>
              </li>
              <li class="nav-group-task">
                <a href="readme.html">README</a>
              </li>
              <li class="nav-group-task">
                <a href="xcodecolors.html">XcodeColors</a>
              </li>
              <li class="nav-group-task">
                <a href="xcodetricks.html">XcodeTricks</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/CLIColor.html">CLIColor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDASLLogCapture.html">DDASLLogCapture</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDASLLogger.html">DDASLLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDAbstractDatabaseLogger.html">DDAbstractDatabaseLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDAbstractLogger.html">DDAbstractLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/c:objc(cs)DDAtomicCounter">DDAtomicCounter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDContextBlacklistFilterLogFormatter.html">DDContextBlacklistFilterLogFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDContextWhitelistFilterLogFormatter.html">DDContextWhitelistFilterLogFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDDispatchQueueLogFormatter.html">DDDispatchQueueLogFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDFileLogger.html">DDFileLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLog.html">DDLog</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileFormatterDefault.html">DDLogFileFormatterDefault</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileInfo.html">DDLogFileInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileManagerDefault.html">DDLogFileManagerDefault</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogMessage.html">DDLogMessage</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLoggerInformation.html">DDLoggerInformation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDMultiFormatter.html">DDMultiFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDOSLogger.html">DDOSLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDTTYLogger.html">DDTTYLogger</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Constants.html#/c:@CocoaLumberjackVersionNumber">CocoaLumberjackVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@CocoaLumberjackVersionString">CocoaLumberjackVersionString</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDLoggerNameASL">DDLoggerNameASL</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDLoggerNameFile">DDLoggerNameFile</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDLoggerNameOS">DDLoggerNameOS</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDLoggerNameTTY">DDLoggerNameTTY</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceBackground">DDQualityOfServiceBackground</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceDefault">DDQualityOfServiceDefault</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceUnspecified">DDQualityOfServiceUnspecified</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceUserInitiated">DDQualityOfServiceUserInitiated</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceUserInteractive">DDQualityOfServiceUserInteractive</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@DDQualityOfServiceUtility">DDQualityOfServiceUtility</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDASLDDLogValue">kDDASLDDLogValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDASLKeyDDLog">kDDASLKeyDDLog</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogFilesDiskQuota">kDDDefaultLogFilesDiskQuota</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogMaxFileSize">kDDDefaultLogMaxFileSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogMaxNumLogFiles">kDDDefaultLogMaxNumLogFiles</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogRollingFrequency">kDDDefaultLogRollingFrequency</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/DDDispatchQueueLogFormatterMode.html">DDDispatchQueueLogFormatterMode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DDLogFlag.html">DDLogFlag</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DDLogLevel.html">DDLogLevel</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DDLogMessageOptions.html">DDLogMessageOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DDAtomicCountable.html">DDAtomicCountable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDLogFileManager.html">DDLogFileManager</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDLogFormatter.html">DDLogFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDLogger.html">DDLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDRegisteredDynamicLogging.html">DDRegisteredDynamicLogging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Type%20Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Type%20Definitions.html#/c:DDTTYLogger.h@T@DDColor">DDColor</a>
              </li>
              <li class="nav-group-task">
                <a href="Type%20Definitions.html#/c:DDLoggerNames.h@T@DDLoggerName">DDLoggerName</a>
              </li>
              <li class="nav-group-task">
                <a href="Type%20Definitions.html#/c:DDDispatchQueueLogFormatter.h@T@DDQualityOfServiceName">DDQualityOfServiceName</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/c:@F@DDExtractFileNameWithoutExtension">DDExtractFileNameWithoutExtension</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/c:DDTTYLogger.h@F@DDMakeColor">DDMakeColor</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p>How to write your own custom formatters.</p>
<h1 id='introduction' class='heading'>Introduction</h1>

<p><strong>Formatters may optionally be added to any logger.</strong> For example, a formatter which prepends the log level (error, warn, info, etc) to log messages being written to a file. To achieve this you may simply create and add a formatter to a file logger. Using formatters gives you the ability to customize the log message appearance without having to rewrite your log messages (or any component of the logging framework).</p>

<p><strong>Formatters can also be used to filter log messages.</strong> That is, you can determine that certain log messages be excluded from a particular logger. For example, you could have a verbose console log, but a concise log file by filtering all but errors and warnings going to a file logger. The criteria for filtering is entirely up to you.</p>

<p>And remember that <strong>formatters are applied individually to loggers</strong>. So you can format and/or filter on a per-logger basis.</p>
<h1 id='details' class='heading'>Details</h1>

<p>It is incredibly simple to create your own custom formatter. The protocol for <code><a href="Protocols/DDLogFormatter.html">DDLogFormatter</a></code> is defined in <code>DDLog.h</code>, and there is only a single required method:</p>
<pre class="highlight objective_c"><code><span class="k">@protocol</span> <span class="nc">DDLogFormatter</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="err">@required</span>

<span class="cm">/**
 * Formatters may optionally be added to any logger.
 * This allows for increased flexibility in the logging environment.
 * For example, log messages for log files may be formatted differently than log messages for the console.
 *
 * For more information about formatters, see the "Custom Formatters" page:
 * Documentation/CustomFormatters.md
 *
 * The formatter may also optionally filter the log message by returning nil,
 * in which case the logger will not log the message.
 **/</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatLogMessage</span><span class="p">:(</span><span class="n">DDLogMessage</span> <span class="o">*</span><span class="p">)</span><span class="nv">logMessage</span><span class="p">;</span>

<span class="k">@optional</span>
<span class="c1">// ...</span>
<span class="k">@end</span>
</code></pre>

<p>It&rsquo;s pretty straight-forward. The single method takes, as a parameter, an instance of <code><a href="Classes/DDLogMessage.html">DDLogMessage</a></code> which contains all the information related to the log message including:</p>

<ul>
<li><code>message</code> - original log message</li>
<li><code>file</code> - full path to the file the log message came from</li>
<li><code>fileName</code> - name of the file the log message came from (without extension)</li>
<li><code>function</code> - method the log message came from</li>
<li><code>line</code> - line number in file where the log message came from</li>
<li><code>timestamp</code> - when the log message was executed</li>
<li><code>level</code> - log level of message (bitmask of flags, e.g. 0111)</li>
<li><code>flag</code> - log flag of message (individual flag that allowed log message to fire, e.g. 0010)</li>
<li><code>threadID</code> - which thread issued the log message</li>
<li><code>queueLabel</code> - name of gcd queue (if applicable)</li>
</ul>

<p>Let&rsquo;s write a simple formatter that automatically simply prepends the log level before every log message.  </p>

<p>The idea is to get log messages like this:</p>
<pre class="highlight objective_c"><code><span class="n">DDLogError</span><span class="p">(</span><span class="s">@"Paper Jam!"</span><span class="p">);</span>       <span class="c1">// E | Paper Jam!</span>
<span class="n">DDLogWarn</span><span class="p">(</span><span class="s">@"Low toner."</span><span class="p">);</span>        <span class="c1">// W | Low toner.</span>
<span class="n">DDLogInfo</span><span class="p">(</span><span class="s">@"Doc printed."</span><span class="p">);</span>      <span class="c1">// I | Doc printed.</span>
<span class="n">DDLogDebug</span><span class="p">(</span><span class="s">@"Debugging"</span><span class="p">);</span>        <span class="c1">// D | Debugging</span>
<span class="n">DDLogVerbose</span><span class="p">(</span><span class="s">@"Init doc_parse"</span><span class="p">);</span> <span class="c1">// V | Init doc_parse.</span>
</code></pre>

<p>MyCustomFormatter.h</p>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "DDLog.h"
</span>
<span class="k">@interface</span> <span class="nc">MyCustomFormatter</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">DDLogFormatter</span><span class="o">&gt;</span>

<span class="k">@end</span>
</code></pre>

<p>MyCustomFormatter.m</p>
<pre class="highlight objective_c"><code><span class="cp">#import "MyCustomFormatter.h"
</span>
<span class="k">@implementation</span> <span class="nc">MyCustomFormatter</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatLogMessage</span><span class="p">:(</span><span class="n">DDLogMessage</span> <span class="o">*</span><span class="p">)</span><span class="nv">logMessage</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">logLevel</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_flag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">DDLogFlagError</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"E"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagWarning</span>  <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"W"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagInfo</span>     <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"I"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagDebug</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"D"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span>                <span class="o">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"V"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@ | %@"</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_message</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>

<p>Now, just add the custom formatter to your logger:</p>
<pre class="highlight plaintext"><code>[DDOSLogger sharedInstance].logFormatter = [[MyCustomFormatter alloc] init];
</code></pre>
<h1 id='thread-safety-simple' class='heading'>Thread-safety (simple)</h1>

<p>Let&rsquo;s update our example formatter to also include the timestamp. To do this we&rsquo;ll use <code>NSDateFormatter</code>. But&hellip; <code>NSDateFormatter</code> is NOT thread-safe (unless you&rsquo;re targeting iOS 7+, or OSX 10.9+ with modern behavior on 64-bit architecture, see <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSDateFormatter_Class/%5D">NSDateFormatter</a>). Does this pose any problems for us?</p>

<p>Log formatters are applied individually to loggers. If you instantiate a log formatter instance, <strong>and apply it to a single logger</strong>, then you don&rsquo;t have to worry about thread-safety. All log messages are sent to the logger (and thus to its log formatter) via the serial dispatch queue of the logger. Thus, in this scenario, the formatLogMessage method is guaranteed to run on only a single thread at a time.</p>

<p>It is very often the case that developers write custom formatters specifically for a particular logger. Thus it is often the case that thread-safety won&rsquo;t be a concern. However, defensive programming is encouraged. There are a few simple hooks that one can use to ensure their thread-unsafe log formatter isn&rsquo;t used inappropriately.</p>
<pre class="highlight objective_c"><code><span class="k">@protocol</span> <span class="nc">DDLogFormatter</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="err">@required</span>

<span class="cm">/**
 * Formatters may optionally be added to any logger.
 * This allows for increased flexibility in the logging environment.
 * For example, log messages for log files may be formatted differently than log messages for the console.
 *
 * For more information about formatters, see the "Custom Formatters" page:
 * Documentation/CustomFormatters.md
 *
 * The formatter may also optionally filter the log message by returning nil,
 * in which case the logger will not log the message.
 **/</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatLogMessage</span><span class="p">:(</span><span class="n">DDLogMessage</span> <span class="o">*</span><span class="p">)</span><span class="nv">logMessage</span><span class="p">;</span>

<span class="k">@optional</span>

<span class="cm">/**
 * A single formatter instance can be added to multiple loggers.
 * These methods provides hooks to notify the formatter of when it's added/removed.
 *
 * This is primarily for thread-safety.
 * If a formatter is explicitly not thread-safe, it may wish to throw an exception if added to multiple loggers.
 * Or if a formatter has potentially thread-unsafe code (e.g. NSDateFormatter),
 * it could possibly use these hooks to switch to thread-safe versions of the code.
 **/</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didAddToLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">willRemoveFromLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre>

<p>Using these hooks, we can add a very simple measure to ensure we don&rsquo;t accidentally shoot ourself in the foot in the future.</p>

<p>This time the idea is to get log messages like this:</p>
<pre class="highlight objective_c"><code><span class="n">DDLogError</span><span class="p">(</span><span class="s">@"Paper Jam!"</span><span class="p">);</span>       <span class="c1">// E 2010/05/20 15:33:18:621 | Paper Jam!</span>
<span class="n">DDLogWarn</span><span class="p">(</span><span class="s">@"Low toner."</span><span class="p">);</span>        <span class="c1">// W 2010/05/20 15:33:18:621 | Low toner.</span>
<span class="n">DDLogInfo</span><span class="p">(</span><span class="s">@"Doc printed."</span><span class="p">);</span>      <span class="c1">// I 2010/05/20 15:33:18:621 | Doc printed.</span>
<span class="n">DDLogDebug</span><span class="p">(</span><span class="s">@"Debugging"</span><span class="p">);</span>        <span class="c1">// D 2010/05/20 15:33:18:621 | Debugging</span>
<span class="n">DDLogVerbose</span><span class="p">(</span><span class="s">@"Init doc_parse"</span><span class="p">);</span> <span class="c1">// V 2010/05/20 15:33:18:621 | Init doc_parse.</span>
</code></pre>

<p>MyCustomFormatter.h</p>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "DDLog.h"
</span>
<span class="k">@interface</span> <span class="nc">MyCustomFormatter</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">DDLogFormatter</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">loggerCount</span><span class="p">;</span>
    <span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">threadUnsafeDateFormatter</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre>

<p>MyCustomFormatter.m</p>
<pre class="highlight objective_c"><code><span class="cp">#import "MyCustomFormatter.h"
</span>
<span class="k">@implementation</span> <span class="nc">MyCustomFormatter</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">((</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">]))</span> <span class="p">{</span>
        <span class="n">threadUnsafeDateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
        <span class="p">[</span><span class="n">threadUnsafeDateFormatter</span> <span class="nf">setDateFormat</span><span class="p">:</span><span class="s">@"yyyy/MM/dd HH:mm:ss:SSS"</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatLogMessage</span><span class="p">:(</span><span class="n">DDLogMessage</span> <span class="o">*</span><span class="p">)</span><span class="nv">logMessage</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">logLevel</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_flag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">DDLogFlagError</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"E"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagWarning</span>  <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"W"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagInfo</span>     <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"I"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagDebug</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"D"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span>                <span class="o">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"V"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">dateAndTime</span> <span class="o">=</span> <span class="p">[</span><span class="n">threadUnsafeDateFormatter</span> <span class="nf">stringFromDate</span><span class="p">:(</span><span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_timestamp</span><span class="p">)];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">logMsg</span> <span class="o">=</span> <span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_message</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@ %@ | %@"</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">dateAndTime</span><span class="p">,</span> <span class="n">logMsg</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didAddToLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span> <span class="p">{</span>
    <span class="n">loggerCount</span><span class="o">++</span><span class="p">;</span>
    <span class="n">NSAssert</span><span class="p">(</span><span class="n">loggerCount</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s">@"This logger isn't thread-safe"</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">willRemoveFromLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span> <span class="p">{</span>
    <span class="n">loggerCount</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>
<h1 id='thread-safety-advanced' class='heading'>Thread-safety (advanced)</h1>

<p>If a log formatter is applied to only a single logger, then thread-safety isn&rsquo;t generally a concern. However, it is perfectly legal to apply a single log formatter instance to multiple loggers. In this case, thread-safety is a concern as the log formatter may be running concurrently on multiple threads. That is, multiple loggers (e.g. console logger &amp; file logger) are run concurrently within Lumberjack, and thus a single log formatter instance attached to both would run concurrently as well.</p>

<p>However, it&rsquo;s typically not that difficult to support multi-threading. The most common case involves NSDateFormatter. These are not thread-safe, but there is a well established work-around by storing instances of NSDateFormatter in the thread dictionary. For example:</p>
<pre class="highlight objective_c"><code><span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">threadDictionary</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]</span> <span class="nf">threadDictionary</span><span class="p">];</span>
<span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[</span><span class="n">threadDictionary</span> <span class="nf">objectForKey</span><span class="p">:</span><span class="n">key</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="n">dateFormatter</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">dateFormatter</span> <span class="nf">setDateFormat</span><span class="p">:</span><span class="n">dateFormatString</span><span class="p">];</span>

    <span class="p">[</span><span class="n">threadDictionary</span> <span class="nf">setObject</span><span class="p">:</span><span class="n">dateFormatter</span> <span class="nf">forKey</span><span class="p">:</span><span class="n">key</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>

<p>But what about the cost? There is fairly small overhead to extract the dateFormatter from the thread dictionary. And there may also be a small overhead to create the dateFormatter instance&rsquo;s on multiple threads within the GCD thread-pool. To mitigate these costs in the common case (single-thread case), while still maintaining support for the multi-thread case, a hybrid approach may be used:</p>

<p>MyCustomFormatter.h</p>
<pre class="highlight objective_c"><code><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import "DDLog.h"
</span>
<span class="k">@interface</span> <span class="nc">MyCustomFormatter</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">DDLogFormatter</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre>

<p>MyCustomFormatter.m</p>
<pre class="highlight objective_c"><code><span class="cp">#import "MyCustomFormatter.h"
</span>
<span class="k">@interface</span> <span class="nc">MyCustomFormatter</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">DDAtomicCounter</span> <span class="o">*</span><span class="n">atomicLoggerCounter</span><span class="p">;</span>
    <span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">threadUnsafeDateFormatter</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">MyCustomFormatter</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">stringFromDate</span><span class="p">:(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">date</span> <span class="p">{</span>
    <span class="kt">int32_t</span> <span class="n">loggerCount</span> <span class="o">=</span> <span class="p">[</span><span class="n">atomicLoggerCounter</span> <span class="nf">value</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">loggerCount</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Single-threaded mode.</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">threadUnsafeDateFormatter</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">threadUnsafeDateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
            <span class="p">[</span><span class="n">threadUnsafeDateFormatter</span> <span class="nf">setDateFormat</span><span class="p">:</span><span class="n">dateFormatString</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">threadUnsafeDateFormatter</span> <span class="nf">stringFromDate</span><span class="p">:</span><span class="n">date</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Multi-threaded mode.</span>
        <span class="c1">// NSDateFormatter is NOT thread-safe.</span>

        <span class="n">NSString</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="s">@"MyCustomFormatter_NSDateFormatter"</span><span class="p">;</span>

        <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">threadDictionary</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSThread</span> <span class="nf">currentThread</span><span class="p">]</span> <span class="nf">threadDictionary</span><span class="p">];</span>
        <span class="n">NSDateFormatter</span> <span class="o">*</span><span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[</span><span class="n">threadDictionary</span> <span class="nf">objectForKey</span><span class="p">:</span><span class="n">key</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dateFormatter</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">dateFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSDateFormatter</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
            <span class="p">[</span><span class="n">dateFormatter</span> <span class="nf">setDateFormat</span><span class="p">:</span><span class="n">dateFormatString</span><span class="p">];</span>

            <span class="p">[</span><span class="n">threadDictionary</span> <span class="nf">setObject</span><span class="p">:</span><span class="n">dateFormatter</span> <span class="nf">forKey</span><span class="p">:</span><span class="n">key</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">dateFormatter</span> <span class="nf">stringFromDate</span><span class="p">:</span><span class="n">date</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">formatLogMessage</span><span class="p">:(</span><span class="n">DDLogMessage</span> <span class="o">*</span><span class="p">)</span><span class="nv">logMessage</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">logLevel</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_flag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">DDLogFlagError</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"E"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagWarning</span>  <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"W"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagInfo</span>     <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"I"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">DDLogFlagDebug</span>    <span class="p">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"D"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span>                <span class="o">:</span> <span class="n">logLevel</span> <span class="o">=</span> <span class="s">@"V"</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">dateAndTime</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stringFromDate</span><span class="p">:(</span><span class="n">logMessage</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">logMsg</span> <span class="o">=</span> <span class="n">logMessage</span><span class="o">-&gt;</span><span class="n">_message</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@ %@ | %@"</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">,</span> <span class="n">dateAndTime</span><span class="p">,</span> <span class="n">logMsg</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didAddToLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">atomicLoggerCounter</span> <span class="nf">increment</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">willRemoveFromLogger</span><span class="p">:(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">DDLogger</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">logger</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">atomicLoggerCounter</span> <span class="nf">decrement</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2020 <a class="link" href="https://github.com/CocoaLumberjack/CocoaLumberjack" target="_blank" rel="external">CocoaLumberjack</a>. All rights reserved. (Last updated: 2020-05-29)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
