<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PerUserLogLevels  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="PerUserLogLevels  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">CocoaLumberjack Docs</a> (66% documented)</p>
        <p class="header-right"><a href="https://github.com/CocoaLumberjack/CocoaLumberjack"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">CocoaLumberjack Reference</a>
        <img id="carat" src="img/carat.png" />
        PerUserLogLevels  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="arc.html">ARC</a>
              </li>
              <li class="nav-group-task">
                <a href="appcode-support.html">AppCode-support</a>
              </li>
              <li class="nav-group-task">
                <a href="architecture.html">Architecture</a>
              </li>
              <li class="nav-group-task">
                <a href="customcontext.html">CustomContext</a>
              </li>
              <li class="nav-group-task">
                <a href="customformatters.html">CustomFormatters</a>
              </li>
              <li class="nav-group-task">
                <a href="customloglevels.html">CustomLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="customloggers.html">CustomLoggers</a>
              </li>
              <li class="nav-group-task">
                <a href="dynamicloglevels.html">DynamicLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="faq.html">FAQ</a>
              </li>
              <li class="nav-group-task">
                <a href="finegrainedlogging.html">FineGrainedLogging</a>
              </li>
              <li class="nav-group-task">
                <a href="gettingstarted.html">GettingStarted</a>
              </li>
              <li class="nav-group-task">
                <a href="logfilemanagement.html">LogFileManagement</a>
              </li>
              <li class="nav-group-task">
                <a href="perloggerloglevels.html">PerLoggerLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="peruserloglevels.html">PerUserLogLevels</a>
              </li>
              <li class="nav-group-task">
                <a href="performance.html">Performance</a>
              </li>
              <li class="nav-group-task">
                <a href="problemsolution.html">ProblemSolution</a>
              </li>
              <li class="nav-group-task">
                <a href="readme.html">README</a>
              </li>
              <li class="nav-group-task">
                <a href="xcodecolors.html">XcodeColors</a>
              </li>
              <li class="nav-group-task">
                <a href="xcodetricks.html">XcodeTricks</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/DDASLLogCapture.html">DDASLLogCapture</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDASLLogger.html">DDASLLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDAbstractLogger.html">DDAbstractLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDFileLogger.html">DDFileLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLog.html">DDLog</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileFormatterDefault.html">DDLogFileFormatterDefault</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileInfo.html">DDLogFileInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogFileManagerDefault.html">DDLogFileManagerDefault</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLogMessage.html">DDLogMessage</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDLoggerInformation.html">DDLoggerInformation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDOSLogger.html">DDOSLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DDTTYLogger.html">DDTTYLogger</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDASLDDLogValue">kDDASLDDLogValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDASLKeyDDLog">kDDASLKeyDDLog</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogFilesDiskQuota">kDDDefaultLogFilesDiskQuota</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogMaxFileSize">kDDDefaultLogMaxFileSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogMaxNumLogFiles">kDDDefaultLogMaxNumLogFiles</a>
              </li>
              <li class="nav-group-task">
                <a href="Constants.html#/c:@kDDDefaultLogRollingFrequency">kDDDefaultLogRollingFrequency</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/DDLogFlag.html">DDLogFlag</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DDLogLevel.html">DDLogLevel</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/DDLogMessageOptions.html">DDLogMessageOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DDLogFileManager.html">DDLogFileManager</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDLogFormatter.html">DDLogFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDLogger.html">DDLogger</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/DDRegisteredDynamicLogging.html">DDRegisteredDynamicLogging</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Type Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Type Definitions.html#/c:DDTTYLogger.h@T@DDColor">DDColor</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/c:@F@DDExtractFileNameWithoutExtension">DDExtractFileNameWithoutExtension</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/c:DDTTYLogger.h@F@DDMakeColor">DDMakeColor</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p>When working as part of a team, different developers are working on different parts of the application. You may be adding a new feature to FileA, while your colleague is trying to track down a bug in FileB. During your development and testing, you increase the log level of FileA to verbose. This spits out a bunch of useful log statements so you can ensure that new feature is working exactly as intended. Excited to see it working, you quickly commit and push your changes. But you forgot to decrease the log level of FileA, and now your colleague sees a bunch of new log statements that don&rsquo;t apply to his/her current development work&hellip;</p>

<p>It&rsquo;s a typical situation. A bit annoying, with several unnecessary commits going back and forth, changing the log levels.</p>

<p>A better solution is using <strong>per-user</strong> log levels:</p>
<pre class="highlight plaintext"><code>// Log levels: off, error, warn, info, verbose
#if defined(DEBUG) &amp;&amp; defined(robbie_hanson)
  static const DDLogLevel ddLogLevel = DDLogLevelVerbose; // Log level for robbie (debug)
#elif defined(DEBUG)
  static const DDLogLevel ddLogLevel = DDLogLevelInfo;    // Log level for other team members (debug)
#else
  static const DDLogLevel ddLogLevel = DDLogLevelWarn;    // Log level for release build
#endif
</code></pre>

<p>(Different log levels per debug / release builds are explained in <a href="XcodeTricks.md">Xcode Tricks</a>)</p>

<p>This way, the developer who&rsquo;s currently working on the file can have their own log level. And everyone else just gets the normal log level. The trick is defining that full_username preprocessor macro.</p>

<p>An example of how to do this is included in the repository under the <code>Xcode/PerUserLogLevels</code> project. Which I&rsquo;ll explain here.</p>

<p>The first step is adding a new header file to your project. We&rsquo;ll call it <code>LumberjackUser.h</code>. You can leave the file completely empty. But when it&rsquo;s all said and done, the file will end up looking like this:</p>
<pre class="highlight plaintext"><code>// This file is automatically generated
#define robbie_hanson 1
</code></pre>

<p>Of course, when you compile the project on your computer, <code>robbie_hanson</code> will get replaced with <code>whatever_your_full_username_is</code>.</p>

<p>Note: You should not add <code>LumberjackUser.h</code> to source control. But it does need to be added to the Xcode project.</p>

<p>Next we&rsquo;re going to add a script to our project that will automatically generate/update the <code>LumberjackUser.h</code> file. I placed the script in a file named <code>LumberjackUser.bash</code>:</p>
<pre class="highlight shell"><code><span class="c">#!/bin/bash</span>

<span class="c"># Get full user name of current user</span>
<span class="c"># E.g. "Robbie Hanson"</span>
<span class="nv">full1</span><span class="o">=</span><span class="k">$(</span>osascript <span class="nt">-e</span> <span class="s2">"tell application </span><span class="se">\\</span><span class="s2">"</span>System Events<span class="se">\\</span><span class="s2">""</span> <span class="nt">-e</span> <span class="s2">"get the full name of the current user"</span> <span class="nt">-e</span> <span class="s2">"end tell"</span><span class="k">)</span>
<span class="c">#echo $full1</span>

<span class="c"># Convert to lower case</span>
<span class="c"># E.g. "robbie hanson"</span>
<span class="nv">full2</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$full1</span> | <span class="nb">awk</span> <span class="s1">'{print tolower($0)}'</span><span class="k">)</span>
<span class="c">#echo $full2</span>

<span class="c"># Replace spaces with underscores</span>
<span class="c"># E.g. "robbie_hanson"</span>
<span class="nv">full3</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">full2</span><span class="p">// /_</span><span class="k">})</span>
<span class="c">#echo $full3</span>

<span class="c"># Remove any characters that are illegal in a macro name</span>
<span class="nv">full4</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$full3</span> | <span class="nb">sed</span> <span class="s1">'s/[^0-9a-zA-Z_]*//g'</span><span class="k">)</span>
<span class="c">#echo $full4</span>

<span class="c"># If we output directly to our intended file, even when nothing has changed,</span>
<span class="c"># then we'll essentially be doing a touch on the file.</span>
<span class="c"># The compiler will see this, and recompile any files that include the header.</span>
<span class="c"># This may mean recompiling every single source file, every single time we do a build!</span>
<span class="c"># So instead we're going to output to a temporary file, and use diff to detect changes.</span>

<span class="nv">temp_filepath</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span><span class="s2">/PerUserLogLevels/LumberjackUser.temp.h"</span>
<span class="nv">final_filepath</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SRCROOT</span><span class="k">}</span><span class="s2">/PerUserLogLevels/LumberjackUser.h"</span>

<span class="nb">echo</span> <span class="s2">"// This file is automatically generated"</span> <span class="o">&gt;</span> <span class="k">${</span><span class="nv">temp_filepath</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s2">"#define </span><span class="nv">$full4</span><span class="s2"> 1"</span> <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">temp_filepath</span><span class="k">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="nt">-a</span> <span class="k">${</span><span class="nv">final_filepath</span><span class="k">}</span> <span class="o">]</span>
    <span class="k">then
    </span><span class="nv">DIFF</span><span class="o">=</span><span class="k">$(</span>diff <span class="k">${</span><span class="nv">temp_filepath</span><span class="k">}</span> <span class="k">${</span><span class="nv">final_filepath</span><span class="k">})</span> 
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$DIFF</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">]</span> 
    <span class="k">then
        </span><span class="nb">cp</span> <span class="nt">-f</span> <span class="k">${</span><span class="nv">temp_filepath</span><span class="k">}</span> <span class="k">${</span><span class="nv">final_filepath</span><span class="k">}</span>
    <span class="k">fi
else
    </span><span class="nb">cp</span> <span class="nt">-f</span> <span class="k">${</span><span class="nv">temp_filepath</span><span class="k">}</span> <span class="k">${</span><span class="nv">final_filepath</span><span class="k">}</span>
<span class="k">fi</span>
</code></pre>

<p>Next we&rsquo;re going to add a new <q>Run Script</q> Build Phase to our target, ensure it&rsquo;s run before the Compile Sources phase, and have it execute our bash script from above:</p>

<p><img src="http://www.deusty.com/blog/CocoaLumberjack/PerUserLogLevels1.png" alt="Screenshot of Xcode"></p>

<p>Finally, you&rsquo;ll want to add <code>LumberjackUser.h</code> and <code>LumberjackUser.temp.h</code> to <code>.gitignore</code></p>

<p>And that&rsquo;s all there is to it. Happy Logging.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://github.com/CocoaLumberjack/CocoaLumberjack" target="_blank" rel="external">CocoaLumberjack</a>. All rights reserved. (Last updated: 2018-09-22)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
